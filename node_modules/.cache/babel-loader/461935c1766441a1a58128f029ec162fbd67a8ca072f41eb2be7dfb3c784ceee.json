{"ast":null,"code":"import _objectSpread from\"/home/vsts/work/1/s/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from\"react\";import{useMsal,useAccount}from\"@azure/msal-react\";import{InteractionRequiredAuthError}from\"@azure/msal-browser\";import{loginRequest}from\"../authConfig\";import ImageUpload from\"./ImageUpload\";import{Grid,Card,CardActionArea,CardContent,Typography,Box}from\"@mui/material\";// Import SubFolder\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChannelsList=_ref=>{let{team,onChannelSelect,onUploadSuccess,onCustomTextChange,customText,isFavorite,cachedChannels=[],// Default leer\nonSaveOffline,cachedSubFolders={}// Default empty\n}=_ref;const{instance,accounts}=useMsal();const account=useAccount(accounts[0]||{});const[channels,setChannels]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[selectedChannel,setSelectedChannel]=useState(null);const[isOnline,setIsOnline]=useState(navigator.onLine);// Online-Status überwachen\nuseEffect(()=>{const handleOnline=()=>setIsOnline(true);const handleOffline=()=>setIsOnline(false);window.addEventListener('online',handleOnline);window.addEventListener('offline',handleOffline);return()=>{window.removeEventListener('online',handleOnline);window.removeEventListener('offline',handleOffline);};},[]);useEffect(()=>{const fetchChannels=async()=>{if(!account||!isOnline){setChannels(cachedChannels);// Verwende gecachte Kanäle, wenn offline oder nicht eingeloggt\nsetLoading(false);return;}const request=_objectSpread(_objectSpread({},loginRequest),{},{account});try{const response=await instance.acquireTokenSilent(request);const accessToken=response.accessToken;const graphResponse=await fetch(\"https://graph.microsoft.com/v1.0/teams/\".concat(team.id,\"/channels\"),{headers:{Authorization:\"Bearer \".concat(accessToken)}});if(graphResponse.ok){const data=await graphResponse.json();setChannels(data.value);}else{setError(\"Failed to fetch channels\");}}catch(err){if(err instanceof InteractionRequiredAuthError){instance.acquireTokenPopup(request).then(response=>{const accessToken=response.accessToken;fetch(\"https://graph.microsoft.com/v1.0/teams/\".concat(team.id,\"/channels\"),{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(res=>res.json()).then(data=>setChannels(data.value));});}else{setError(\"Error fetching channels\");}}finally{setLoading(false);}};fetchChannels();},[instance,account,team.id,isOnline,cachedChannels]);const handleChannelSelect=channel=>{setSelectedChannel(channel);onChannelSelect(channel);};if(loading&&account&&isOnline)return/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Loading channels...\"});// Nur laden, wenn account und online\nif(error)return/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",color:\"error\",children:[\"Error: \",error]});return/*#__PURE__*/_jsxs(Box,{sx:{mt:3},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",gutterBottom:true,children:[\"Kanal ausw\\xE4hlen (\",isOnline&&account?'Online':'Offline gecacht',\")\"]}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:channels.map(channel=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(Card,{sx:{cursor:'pointer',border:(selectedChannel===null||selectedChannel===void 0?void 0:selectedChannel.id)===channel.id?'2px solid #007aff':'1px solid #ddd',transition:'all 0.3s ease'},onClick:()=>handleChannelSelect(channel),children:/*#__PURE__*/_jsx(CardActionArea,{children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",component:\"div\",children:channel.displayName})})})})})},channel.id))}),selectedChannel&&/*#__PURE__*/_jsx(ImageUpload,{team:team,channel:selectedChannel,onUploadSuccess:onUploadSuccess,onCustomTextChange:onCustomTextChange,customText:customText,onSaveOffline:onSaveOffline// Pass cached subfolders for this specific channel\n,cachedSubFolders:cachedSubFolders[selectedChannel.id]||[]})]});};export default ChannelsList;","map":{"version":3,"names":["React","useEffect","useState","useMsal","useAccount","InteractionRequiredAuthError","loginRequest","ImageUpload","Grid","Card","CardActionArea","CardContent","Typography","Box","jsx","_jsx","jsxs","_jsxs","ChannelsList","_ref","team","onChannelSelect","onUploadSuccess","onCustomTextChange","customText","isFavorite","cachedChannels","onSaveOffline","cachedSubFolders","instance","accounts","account","channels","setChannels","loading","setLoading","error","setError","selectedChannel","setSelectedChannel","isOnline","setIsOnline","navigator","onLine","handleOnline","handleOffline","window","addEventListener","removeEventListener","fetchChannels","request","_objectSpread","response","acquireTokenSilent","accessToken","graphResponse","fetch","concat","id","headers","Authorization","ok","data","json","value","err","acquireTokenPopup","then","res","handleChannelSelect","channel","variant","children","color","sx","mt","gutterBottom","container","spacing","map","item","xs","sm","md","cursor","border","transition","onClick","component","displayName"],"sources":["/home/vsts/work/1/s/src/ui-components/ChannelsList.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useMsal, useAccount } from \"@azure/msal-react\";\nimport { InteractionRequiredAuthError } from \"@azure/msal-browser\";\nimport { loginRequest } from \"../authConfig\";\nimport ImageUpload from \"./ImageUpload\";\nimport { Grid, Card, CardActionArea, CardContent, Typography, Box } from \"@mui/material\";\nimport { SubFolder } from '../db'; // Import SubFolder\n\ninterface Team {\n    id: string;\n    displayName: string;\n}\n\ninterface Channel {\n    id: string;\n    displayName: string;\n}\n\ninterface ChannelsListProps {\n    team: Team;\n    onChannelSelect: (channel: Channel | null) => void;\n    onUploadSuccess: (urls: string[], files?: File[], base64Images?: string[]) => void;\n    onCustomTextChange: (text: string) => void;\n    customText: string;\n    isFavorite: boolean;\n    cachedChannels?: Channel[];  // Neue Prop für gecachte Kanäle\n    onSaveOffline?: (files: File[]) => void;  // Füge onSaveOffline Prop hinzu\n    cachedSubFolders?: { [channelId: string]: SubFolder[] }; // New Prop\n}\n\nconst ChannelsList: React.FC<ChannelsListProps> = ({\n    team,\n    onChannelSelect,\n    onUploadSuccess,\n    onCustomTextChange,\n    customText,\n    isFavorite,\n    cachedChannels = [],  // Default leer\n    onSaveOffline,\n    cachedSubFolders = {}, // Default empty\n}) => {\n    const { instance, accounts } = useMsal();\n    const account = useAccount(accounts[0] || {});\n    const [channels, setChannels] = useState<Channel[]>([]);\n    const [loading, setLoading] = useState<boolean>(true);\n    const [error, setError] = useState<string | null>(null);\n    const [selectedChannel, setSelectedChannel] = useState<Channel | null>(null);\n    const [isOnline, setIsOnline] = useState(navigator.onLine);\n\n    // Online-Status überwachen\n    useEffect(() => {\n        const handleOnline = () => setIsOnline(true);\n        const handleOffline = () => setIsOnline(false);\n        window.addEventListener('online', handleOnline);\n        window.addEventListener('offline', handleOffline);\n        return () => {\n            window.removeEventListener('online', handleOnline);\n            window.removeEventListener('offline', handleOffline);\n        };\n    }, []);\n\n    useEffect(() => {\n        const fetchChannels = async () => {\n            if (!account || !isOnline) {\n                setChannels(cachedChannels);  // Verwende gecachte Kanäle, wenn offline oder nicht eingeloggt\n                setLoading(false);\n                return;\n            }\n\n            const request = { ...loginRequest, account };\n\n            try {\n                const response = await instance.acquireTokenSilent(request);\n                const accessToken = response.accessToken;\n\n                const graphResponse = await fetch(`https://graph.microsoft.com/v1.0/teams/${team.id}/channels`, {\n                    headers: { Authorization: `Bearer ${accessToken}` },\n                });\n\n                if (graphResponse.ok) {\n                    const data = await graphResponse.json();\n                    setChannels(data.value);\n                } else {\n                    setError(\"Failed to fetch channels\");\n                }\n            } catch (err) {\n                if (err instanceof InteractionRequiredAuthError) {\n                    instance.acquireTokenPopup(request).then((response) => {\n                        const accessToken = response.accessToken;\n                        fetch(`https://graph.microsoft.com/v1.0/teams/${team.id}/channels`, {\n                            headers: { Authorization: `Bearer ${accessToken}` },\n                        }).then((res) => res.json()).then((data) => setChannels(data.value));\n                    });\n                } else {\n                    setError(\"Error fetching channels\");\n                }\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchChannels();\n    }, [instance, account, team.id, isOnline, cachedChannels]);\n\n    const handleChannelSelect = (channel: Channel) => {\n        setSelectedChannel(channel);\n        onChannelSelect(channel);\n    };\n\n    if (loading && account && isOnline) return <Typography variant=\"h6\">Loading channels...</Typography>;  // Nur laden, wenn account und online\n    if (error) return <Typography variant=\"h6\" color=\"error\">Error: {error}</Typography>;\n\n    return (\n        <Box sx={{ mt: 3 }}>\n            <Typography variant=\"h6\" gutterBottom>\n                Kanal auswählen ({isOnline && account ? 'Online' : 'Offline gecacht'})\n            </Typography>\n            <Grid container spacing={2}>\n                {channels.map((channel) => (\n                    <Grid item xs={12} sm={6} md={4} key={channel.id}>\n                        <Card\n                            sx={{\n                                cursor: 'pointer',\n                                border: selectedChannel?.id === channel.id ? '2px solid #007aff' : '1px solid #ddd',\n                                transition: 'all 0.3s ease'\n                            }}\n                            onClick={() => handleChannelSelect(channel)}\n                        >\n                            <CardActionArea>\n                                <CardContent>\n                                    <Box>\n                                        <Typography variant=\"subtitle1\" component=\"div\">\n                                            {channel.displayName}\n                                        </Typography>\n                                    </Box>\n                                </CardContent>\n                            </CardActionArea>\n                        </Card>\n                    </Grid>\n                ))}\n            </Grid>\n            {selectedChannel && (\n                <ImageUpload\n                    team={team}\n                    channel={selectedChannel}\n                    onUploadSuccess={onUploadSuccess}\n                    onCustomTextChange={onCustomTextChange}\n                    customText={customText}\n                    onSaveOffline={onSaveOffline}\n                    // Pass cached subfolders for this specific channel\n                    cachedSubFolders={cachedSubFolders[selectedChannel.id] || []}\n                />\n            )}\n        </Box>\n    );\n};\n\nexport default ChannelsList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}